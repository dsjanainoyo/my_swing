<%= render 'layouts/public_header'%>

<h2><%=@event.name%></h2>

<% if @event.event_image.attached?%>
  <%=image_tag @event.event_image, size: '200x200'%>
<%else%>
  <%=image_tag 'no_image', size: '200x200'%>
<%end%>

<table class="table">
    <tbody>
        <tr>
            <td>ミュージシャン名</td>
            <td><%=@event.musician.name%></td>
        </tr>
        
        <tr>
            <td>説明文</td>
            <td><%=@event.introduction%></td>
        </tr>
        
        <tr>
            <td>日時</td>
            <td><%=@event.datetime%></td>
        </tr>
        
        <tr>
            <td>場所</td>
            <td><%=@event.place%></td>
        </tr>
        
        <tr>
            <td>ジャンル</td>
            <% @event.genre_items.each do |genre_item|%>
                <td><%=genre_item.name%></td>
            <%end%>
        </tr>
        
        <tr>
            <td>予約ステータス</td>
            <td><%=@event.seating_status%></td>
        </tr>
    </tbody>
</table>
<% if current_user.present?%>
    <% if @event.favorite_by?(current_user)%>
      <%=link_to "いいねをやめる", public_event_favorites_path(@event),method: :delete,class:"btn btn-danger"%>
    <%else%>
      <%=link_to "いいね", public_event_favorites_path(@event),method: :post,class:"btn btn-light"%>
    <%end%>


<%=link_to "予約する", new_public_event_reservation_path(@event.id),class:"btn btn-primary"%>
<%end%>


<h3>コメント</h3>
<% if current_user.present?%>
    <%=form_with model: [@event,@comment],url: public_event_comments_path(@event) do |f|%>
      <%=f.text_area :comment,placeholder: 'コメントを記述'%>
      <%=f.submit 'コメント',class:"btn btn-success"%>
    <%end%>
    
    <% @event.comments.each do |comment|%>
      <% if comment.user_id==current_user.id%>
    
        <% if comment.user.user_image.attached?%>
          <%=image_tag comment.user.user_image,size: '100x100'%>
        <%else%>
          <%=image_tag 'no_image',size: '100x100'%>
        <%end%>
        <%=comment.user.name%>
        <%=comment.comment%>
        <%=comment.created_at.strftime('%Y/%m/%d')%>
        
      <%else%>
      
        <% if comment.musician.musician_image.attached?%>
          <%=image_tag comment.musician.musician_image,size: '100x100'%>
        <%else%>
          <%=image_tag 'no_image',size: '100x100'%>
        <%end%>
        <%=comment.musician.name%>
        <%=comment.comment%>
        <%=comment.created_at.strftime('%Y/%m/%d')%>  
    
        
      <%end%>
    <%end%>
<%else%>
  <p>コメントするにはログインしてください</p>
<%end%>
  
  